# ๐ง ุฑุงูููุง ุณุฑุน ุญู ูุดฺฉู ุงุดุชุฑุงฺฉโฺฏุฐุงุฑ

## ูุดฺฉู ูุนู
ุฎุทุง `column "shared_by" does not exist` - ุฌุฏูู `patient_shares` ูุฌูุฏ ุฏุงุฑุฏ ุงูุง ุณุชููโูุง ููุฑุฏ ูุงุฒ ุฑุง ูุฏุงุฑุฏ.

## ุฑุงู ุญู ุณุฑุน

### ูุฑุญูู 1: ุจุฑุฑุณ ุณุงุฎุชุงุฑ ูุนู
ูุงู `check-current-table.sql` ุฑุง ุฏุฑ Supabase ุงุฌุฑุง ฺฉูุฏ ุชุง ุจุจูุฏ ฺู ุณุชููโูุง ูุฌูุฏ ุฏุงุฑุฏ.

### ูุฑุญูู 2: ุงุตูุงุญ ุฌุฏูู
ูุงู `fix-patient-shares-table.sql` ุฑุง ุงุฌุฑุง ฺฉูุฏ. ุงู ูุงู:
- ุณุชููโูุง ฺฏูุดุฏู ุฑุง ุงุถุงูู ูโฺฉูุฏ
- ุณุงุฎุชุงุฑ ููุง ุฑุง ููุงุด ูโุฏูุฏ
- ฺฉ ุฑฺฉูุฑุฏ ุชุณุช ุฏุฑุฌ ูโฺฉูุฏ

### ูุฑุญูู 3: ุชุณุช
ูพุณ ุงุฒ ุงุฌุฑุง ููููุ ุจุงุฏ ูพุงูโูุง ุฒุฑ ุฑุง ุจุจูุฏ:
- `Column shared_by added`
- `Column shared_with added`
- `Column permissions added`
- ู ุบุฑู...

## ุงฺฏุฑ ูููุฒ ูุดฺฉู ุฏุงุฑุฏ:

### ฺฏุฒูู 1: ุญุฐู ู ุงุฌุงุฏ ูุฌุฏุฏ
```sql
-- ุญุฐู ุฌุฏูู ููุฌูุฏ
DROP TABLE IF EXISTS patient_shares;

-- ุงุฌุฑุง ูุงู step-by-step-sharing-setup.sql
```

### ฺฏุฒูู 2: ุจุฑุฑุณ Foreign Key
```sql
-- ุจุฑุฑุณ ูุฌูุฏ ุฌุฏูู patients
SELECT EXISTS (
  SELECT FROM information_schema.tables 
  WHERE table_schema = 'public' 
  AND table_name = 'patients'
);
```

### ฺฏุฒูู 3: ุบุฑูุนุงู ฺฉุฑุฏู ูููุช RLS
```sql
ALTER TABLE patient_shares DISABLE ROW LEVEL SECURITY;
-- ุชุณุช ุฏุฑุฌ
-- ุณูพุณ ูุนุงู ฺฉุฑุฏู ูุฌุฏุฏ
ALTER TABLE patient_shares ENABLE ROW LEVEL SECURITY;
```

## ุณุงุฎุชุงุฑ ููุง ููุฑุฏ ุงูุชุธุงุฑ
ูพุณ ุงุฒ ุงุฌุฑุง ููููุ ุฌุฏูู ุจุงุฏ ุงู ุณุชููโูุง ุฑุง ุฏุงุดุชู ุจุงุดุฏ:

| ุณุชูู | ููุน |
|------|-----|
| id | UUID |
| patient_id | UUID |
| shared_by | UUID |
| shared_with | UUID |
| share_token | TEXT |
| permissions | TEXT[] |
| expires_at | TIMESTAMP |
| is_active | BOOLEAN |
| created_at | TIMESTAMP |
| updated_at | TIMESTAMP |

## ุฏุณุชูุฑุงูุนูู ููุง
1. `check-current-table.sql` ุฑุง ุงุฌุฑุง ฺฉูุฏ
2. `fix-patient-shares-table.sql` ุฑุง ุงุฌุฑุง ฺฉูุฏ
3. ุงฺฏุฑ ูููู ุจูุฏุ ุจู ุจุฑูุงูู ุจุฑฺฏุฑุฏุฏ ู ุชุณุช ฺฉูุฏ
4. ุงฺฏุฑ ุฎุทุง ุฏุงุดุชุฏุ ุงุฒ ฺฏุฒููโูุง ุจุงูุง ุงุณุชูุงุฏู ฺฉูุฏ

๐ฏ **ูุฏู**: ุญู ูุดฺฉู ุณุชูู `shared_by` ู ุขูุงุฏูโุณุงุฒ ุฌุฏูู ุจุฑุง ุณุณุชู ุงุดุชุฑุงฺฉโฺฏุฐุงุฑ 